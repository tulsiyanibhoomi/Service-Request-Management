generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model role {
  roleid      Int         @id @default(autoincrement())
  rolename    String      @unique(map: "rolename") @db.VarChar(50)
  description String?     @db.VarChar(255)
  isactive    Boolean?    @default(true)
  created     DateTime?   @default(now()) @db.Timestamp(0)
  modified    DateTime?   @default(now()) @db.Timestamp(0)
  user_role   user_role[]
}

model user_role {
  userid Int
  roleid Int
  role   role  @relation(fields: [roleid], references: [roleid], onDelete: Cascade, onUpdate: NoAction, map: "fk_userrole_role")
  users  users @relation(fields: [userid], references: [userid], onDelete: Cascade, onUpdate: NoAction, map: "fk_userrole_user")

  @@id([userid, roleid])
  @@index([roleid], map: "fk_userrole_role")
}

model users {
  userid                           Int                                @id @default(autoincrement())
  username                         String                             @unique(map: "username") @db.VarChar(50)
  fullname                         String                             @db.VarChar(100)
  email                            String                             @unique(map: "email") @db.VarChar(100)
  password                         String                             @db.VarChar(255)
  isactive                         Boolean?                           @default(true)
  created                          DateTime?                          @default(now()) @db.Timestamp(0)
  modified                         DateTime?                          @default(now()) @db.Timestamp(0)
  salt                             String                             @default("mysaltvalue") @db.VarChar(255)
  service_dept_person              service_dept_person[]
  service_request                  service_request[]
  service_request_reply            service_request_reply[]
  service_request_status_history   service_request_status_history[]
  service_request_type_wise_person service_request_type_wise_person[]
  technician                       technician?
  user_role                        user_role[]
}

model service_dept {
  service_dept_id     Int                   @id @default(autoincrement())
  service_dept_name   String                @db.VarChar(250)
  description         String?               @db.VarChar(250)
  created             DateTime              @db.DateTime(0)
  modified            DateTime              @db.DateTime(0)
  cc_email_to_csv     String?               @db.VarChar(250)
  isactive            Boolean               @default(true)
  service_dept_person service_dept_person[]
  service_type        service_type[]
  technician          technician[]
}

model service_dept_person {
  service_dept_person_id Int          @id @default(autoincrement())
  service_dept_id        Int
  from_date              DateTime     @db.DateTime(0)
  to_date                DateTime?    @db.DateTime(0)
  userid                 Int
  created                DateTime     @db.DateTime(0)
  modified               DateTime     @db.DateTime(0)
  is_hod                 Boolean?
  service_dept           service_dept @relation(fields: [service_dept_id], references: [service_dept_id], onDelete: NoAction, onUpdate: NoAction, map: "service_dept_person_ibfk_1")
  users                  users        @relation(fields: [userid], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "service_dept_person_ibfk_2")

  @@index([service_dept_id], map: "service_dept_id")
  @@index([userid], map: "userid")
}

model service_request {
  service_request_id             Int                              @id @default(autoincrement())
  service_request_no             String                           @db.VarChar(500)
  service_request_type_id        Int
  service_request_title          String                           @db.VarChar(250)
  service_request_description    String                           @db.VarChar(2000)
  attachment_path                String?                          @db.VarChar(250)
  service_request_status_id      Int
  assigned_to_technician_id      Int?
  assigned_by_user_id            Int?
  employee_id                    Int
  priority_level                 String?                          @db.VarChar(50)
  attachment_path2               String?                          @db.VarChar(250)
  attachment_path3               String?                          @db.VarChar(250)
  attachment_path4               String?                          @db.VarChar(250)
  attachment_path5               String?                          @db.VarChar(250)
  submitted_at                   DateTime?                        @db.DateTime(0)
  service_request_datetime       DateTime?                        @db.DateTime(0)
  reassignment_requested         Boolean?                         @default(false)
  reassignment_requested_reason  String?                          @db.VarChar(255)
  technician                     technician?                      @relation(fields: [assigned_to_technician_id], references: [technician_id], map: "fk_assigned_to_technician")
  service_request_status         service_request_status           @relation(fields: [service_request_status_id], references: [service_request_status_id], onDelete: NoAction, onUpdate: NoAction, map: "service_request_ibfk_1")
  service_request_type           service_type                     @relation(fields: [service_request_type_id], references: [service_type_id], onDelete: NoAction, onUpdate: NoAction, map: "service_request_ibfk_2")
  users                          users                            @relation(fields: [employee_id], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "service_request_ibfk_3")
  service_request_reply          service_request_reply[]
  service_request_status_history service_request_status_history[]

  @@index([service_request_status_id], map: "service_request_status_id")
  @@index([employee_id], map: "userid")
  @@index([assigned_by_user_id], map: "fk_assigned_by_user")
  @@index([service_request_type_id], map: "service_request_ibfk_2")
  @@index([assigned_to_technician_id], map: "fk_assigned_to_technician")
}

model service_request_reply {
  service_request_reply_id           Int                    @id @default(autoincrement())
  service_request_id                 Int
  service_request_reply_datetime     DateTime               @db.DateTime(0)
  service_request_reply_description  String                 @db.VarChar(250)
  attachment_path                    String?                @db.VarChar(250)
  service_request_status_id          Int
  service_request_status_datetime    DateTime               @db.DateTime(0)
  service_request_status_by_user_id  Int
  service_request_status_description String?                @db.VarChar(250)
  description                        String?                @db.VarChar(250)
  userid                             Int
  created                            DateTime               @db.DateTime(0)
  service_request                    service_request        @relation(fields: [service_request_id], references: [service_request_id], onDelete: NoAction, onUpdate: NoAction, map: "service_request_reply_ibfk_1")
  service_request_status             service_request_status @relation(fields: [service_request_status_id], references: [service_request_status_id], onDelete: NoAction, onUpdate: NoAction, map: "service_request_reply_ibfk_2")
  users                              users                  @relation(fields: [userid], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "service_request_reply_ibfk_3")

  @@index([service_request_id], map: "service_request_id")
  @@index([service_request_status_id], map: "service_request_status_id")
  @@index([userid], map: "userid")
}

model service_request_status {
  service_request_status_id      Int                              @id @default(autoincrement())
  service_request_status_name    String                           @db.VarChar(250)
  description                    String?                          @db.VarChar(250)
  service_request                service_request[]
  service_request_reply          service_request_reply[]
  service_request_status_history service_request_status_history[]
}

model service_request_type_wise_person {
  service_request_type_wise_person_id Int       @id @default(autoincrement())
  service_request_type_id             Int
  staff_id                            Int
  from_date                           DateTime  @db.DateTime(0)
  to_date                             DateTime? @db.DateTime(0)
  description                         String?   @db.VarChar(250)
  userid                              Int
  created                             DateTime  @db.DateTime(0)
  modified                            DateTime  @db.DateTime(0)
  users                               users     @relation(fields: [userid], references: [userid], onDelete: NoAction, onUpdate: NoAction, map: "service_request_type_wise_person_ibfk_2")

  @@index([service_request_type_id], map: "service_request_type_id")
  @@index([userid], map: "userid")
}

model service_type {
  service_type_id   Int               @id @default(autoincrement())
  service_type_name String            @db.VarChar(250)
  description       String?           @db.VarChar(250)
  created           DateTime          @db.DateTime(0)
  modified          DateTime          @db.DateTime(0)
  dept_id           Int
  isactive          Boolean?          @default(true)
  service_request   service_request[]
  service_dept      service_dept      @relation(fields: [dept_id], references: [service_dept_id], onDelete: NoAction, onUpdate: NoAction, map: "service_type_ibfk_2")

  @@index([dept_id], map: "service_type_ibfk_2")
}

model technician {
  technician_id        Int                            @id
  max_requests_allowed Int                            @default(5)
  availability_status  technician_availability_status @default(available)
  service_dept_id      Int
  service_request      service_request[]
  users                users                          @relation(fields: [technician_id], references: [userid], onDelete: Cascade, map: "technician_ibfk_1")
  service_dept         service_dept                   @relation(fields: [service_dept_id], references: [service_dept_id], map: "technician_ibfk_2")

  @@index([service_dept_id], map: "service_dept_id")
}

model service_request_status_history {
  id                     BigInt                 @id @default(autoincrement())
  request_id             Int
  status_id              Int
  changed_by_user_id     Int
  changed_at             DateTime               @default(now()) @db.DateTime(0)
  notes                  String?                @db.VarChar(255)
  service_request        service_request        @relation(fields: [request_id], references: [service_request_id], onDelete: Cascade, map: "fk_status_history_request")
  service_request_status service_request_status @relation(fields: [status_id], references: [service_request_status_id], map: "fk_status_history_status")
  users                  users                  @relation(fields: [changed_by_user_id], references: [userid], map: "fk_status_history_user")

  @@index([request_id], map: "fk_status_history_request")
  @@index([status_id], map: "fk_status_history_status")
  @@index([changed_by_user_id], map: "fk_status_history_user")
}

enum technician_availability_status {
  available
  busy
  on_leave
}
